<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Measure.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Measures</a> &gt; <a href="index.source.html" class="el_package">de.turnertech.measures</a> &gt; <span class="el_source">Measure.java</span></div><h1>Measure.java</h1><pre class="source lang-java linenums">package de.turnertech.measures;

import java.util.Objects;

/**
 * &lt;p&gt;A Measure is a description of some quantity of a {@link Unit}, where a {@link Unit} is a standardised and
 * accepted quantity, size, ammount, period or other kind of measurement. For example, a {@link Unit#METRE} 
 * represents a standardised length.&lt;/p&gt;
 * 
 * &lt;p&gt;This implementation stores an immutable {@link Unit} instance. To obtain a {@link Measure} with another
 * {@link Unit} you must either explicitely instantiate a new instance, or convert the Measure using one of the
 * either {@link #convertTo(Unit)} or the class {@link UnitConverter}&lt;/p&gt;
 */
public class Measure {
    
    private double quantity;

    private final Unit unit;
    
    /**
     * Constructs an instance with the provided parameters.
     * @param quantity The quantity of Units in this Measure. Mutable.
     * @param unit The Unit of this Measure. This is immutable.
     */
<span class="fc" id="L25">    public Measure(final double quantity, final Unit unit) {</span>
<span class="fc" id="L26">        this.quantity = quantity;</span>
<span class="fc" id="L27">        this.unit = Objects.requireNonNull(unit, &quot;Unit instance provided to Measure constructor may not be null&quot;);</span>
<span class="fc" id="L28">    }</span>

    /**
     * &lt;p&gt;Helper function for checking if the Measure is equal to within a supplied
     * tolerance. This is usefull in several situations as the Double Precision
     * mechanism can very quickly introduce innacuracies which prevent .equals() 
     * from providing a useful result.&lt;/p&gt;
     * 
     * &lt;p&gt;If the Measures do not suare the same base unit, a conversion will 
     * first be attempted.&lt;/p&gt;
     * 
     * @param other Measure to check against.
     * @param tolerance allowed difference between the numbers.
     * @return true or false.
     */
    public boolean equalsWithTolerance(final Measure other, final double tolerance) {
<span class="fc" id="L44">        final Measure otherInThisUnit = UnitConverter.convert(other.quantity, other.unit, unit);</span>
<span class="fc" id="L45">        final double difference = Math.abs(this.quantity - otherInThisUnit.quantity);</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">        return difference &lt;= tolerance;</span>
    }

    /**
     * Gets the quantity of Units stored in this Measure.
     * @return the quantity of Units stored in this Measure.
     */
    public double getQuantity() {
<span class="fc" id="L54">        return quantity;</span>
    }

    /**
     * Sets the quantity of Units stored in this Measure.
     * @param quantity the quantity of Units stored in this Measure.
     */
    public void setQuantity(final double quantity) {
<span class="fc" id="L62">        this.quantity = quantity;</span>
<span class="fc" id="L63">    }</span>

    /**
     * Sets the Unit of this Measure.
     * @return the Unit of this Measure.
     */
    public Unit getUnit() {
<span class="fc" id="L70">        return unit;</span>
    }

    /**
     * &lt;p&gt;Helper function to convert this Measure to a new Measure with the 
     * supplied newUnit parameter. This function exists in place of a setter as
     * the unit member is immutable.&lt;/p&gt;
     * 
     * &lt;p&gt;Internally this function simply delegates to 
     * {@link UnitConverter#convert(Measure, Unit)}&lt;/p&gt;
     * 
     * @param newUnit to be used in the creation of the new Measure instance.
     * @return a new Measure instance in the supplied Unit.
     */
    public Measure convertTo(final Unit newUnit) {
<span class="fc" id="L85">        return UnitConverter.convert(this, newUnit);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L90">        int hash = 5;</span>
<span class="nc" id="L91">        hash = 61 * hash + (int) (Double.doubleToLongBits(this.quantity) ^ (Double.doubleToLongBits(this.quantity) &gt;&gt;&gt; 32));</span>
<span class="nc" id="L92">        hash = 61 * hash + Objects.hashCode(this.unit);</span>
<span class="nc" id="L93">        return hash;</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">        if (this == obj) {</span>
<span class="nc" id="L99">            return true;</span>
        }
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        if (obj == null) {</span>
<span class="nc" id="L102">            return false;</span>
        }
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L105">            return false;</span>
        }
<span class="fc" id="L107">        final Measure other = (Measure) obj;</span>
<span class="pc bpc" id="L108" title="1 of 2 branches missed.">        if (Double.doubleToLongBits(this.quantity) != Double.doubleToLongBits(other.quantity)) {</span>
<span class="nc" id="L109">            return false;</span>
        }
<span class="fc" id="L111">        return Objects.equals(this.unit, other.unit);</span>
    }
    
    /**
     * We use the SI standard for the String representation. There is always a
     * space between the quantity and unit, unless it is a planar angle.
     * @return the Measure as a string formatted as per the SI Brochure section 
     * 5.3.3
     */
    @Override
    public String toString() {
<span class="nc bnc" id="L122" title="All 6 branches missed.">        if(unit == Unit.DEGREE || unit == Unit.MINUTE_ANGLE || unit == Unit.SECOND_ANGLE) {</span>
<span class="nc" id="L123">            return String.format(&quot;%f%s&quot;, quantity, unit.toString());</span>
        }
<span class="nc" id="L125">        return String.format(&quot;%f %s&quot;, quantity, unit.toString());</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>